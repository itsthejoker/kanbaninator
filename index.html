<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kanban board interface for Joplin notes - organize your notes visually">
    <meta name="theme-color" content="#007bff">
    <title>Joplin Kanbaninator</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
    <link rel="stylesheet" href="static/vendored/bootstrap.min.css">
    <link rel="stylesheet" href="static/vendored/jkanban.min.css">
    <link rel="stylesheet" href="static/styles.css">
    <style>
        /* Critical modal animations - ensure they're loaded first */
        .modal.fade .modal-dialog {
            transform: scale(0.85) !important;
            opacity: 0 !important;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important,
                        opacity 0.4s ease !important;
        }
        .modal.show .modal-dialog {
            transform: scale(1) !important;
            opacity: 1 !important;
        }
        .modal.custom-animation.fade .modal-dialog {
            transform: translateY(40px) scale(0.95) !important;
            opacity: 0 !important;
        }
        .modal.custom-animation.show .modal-dialog {
            transform: translateY(0) scale(1) !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body class="">
<!-- Spinner -->
<div id="loadingSpinnerContainer" style="display: none">
    <h2 class="text-center mt-5">Please check Joplin to accept the connection.</h2>
    <img id="loadingSpinner"
        class="position-absolute top-50 start-50 translate-middle"
        src="static/Double%20Ring-1s-267px.gif"
    >
</div>

<!-- Start Modal -->
<div class="modal modal-lg custom-animation" id="startModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="startModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="startModalLabel">Joplin Kanbaninator</h1>
            </div>
            <div class="modal-body">
                <p>
                    Welcome to Kanbaninator for <a href="https://joplinapp.org/" target="_blank">Joplin</a>!
                    Joplin is a note-taking app that lets you keep complete control of your data, and this
                    app gives you a way to organize some of that data in a kanban-style board while ensuring
                    you keep your data where it should stay: with you.
                </p>
                <p>
                    <strong>Setup:</strong> in Joplin, create an empty notebook that will be your 'base' for
                    the board.
                </p>
                <p>
                    Kanbaninator uses the 'web clipper' service system that's built into Joplin to interact
                    with your notes. On your desktop app, go to <strong>Tools > Options > Web Clipper</strong>,
                    then enable the service if it isn't already enabled. You'll only need one thing here to
                    get started: what is the port number displayed?
                </p>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="joplin_port_number">Port Number</span>
                    <input type="text" class="form-control" aria-label="Sizing example input"
                           aria-describedby="joplin_port_number" value="41184">
                </div>
                <p>
                    You should see a dialogue appear in your Joplin app asking if you want to authorize the
                    Web Clipper connection; click "Grant Authorisation" to get started.
                </p>
                <p style="display: none" id="portNumberError"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="validatePort()">Authenticate</button>
            </div>
        </div>
    </div>
</div>

<!-- Folder Modal -->
<div class="modal modal-lg custom-animation" id="folderModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="folderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="folderModalLabel">What Notebook Are You Working In?</h1>
            </div>
            <div class="modal-body">
                <p>
                    Here are the notebooks we can see. Which notebook is the root notebook for your
                    kanban board?
                </p>
                <p>
                    If we don't detect a configuration note, we'll go ahead and create one.
                </p>
                <ul id="folderList"></ul>
            </div>
        </div>
    </div>
</div>

<!-- Title Modal -->
<div class="modal modal-lg custom-animation" id="titleModal" tabindex="-1"
     aria-labelledby="titleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="titleModalLabel">Change Board Title</h1>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="boardTitleField" class="form-label">Title</label>
                    <input type="text" class="form-control" aria-label="Title of the board" id="boardTitleField">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="updateBoardTitle()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Note Modal -->
<div class="modal modal-lg custom-animation" id="editNoteModal" tabindex="-1"
     aria-labelledby="editNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="editNoteModalLabel">View / Edit Note</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="noteTitleField" class="form-label">Title</label>
                    <input type="text" class="form-control" aria-label="Title of the note" id="noteTitleField">
                </div>
                <div class="form-floating">
                    <div id="currentNoteId" class="d-none"></div>
                    <textarea class="form-control" placeholder="Note content..." id="noteBodyField"
                              style="height: 150px"></textarea>
                    <label for="noteBodyField">Note Body</label>
                </div>
                <hr>
                <p class="text-center mb-2">Card Color:</p>
                <div class="color-picker-container">
                    <div class="color-option col1" id="col1option">
                        <input type="radio" name="colorRadio" id="col1radio" value="col1">
                    </div>
                    <div class="color-option col2" id="col2option">
                        <input type="radio" name="colorRadio" id="col2radio" value="col2">
                    </div>
                    <div class="color-option col3" id="col3option">
                        <input type="radio" name="colorRadio" id="col3radio" value="col3">
                    </div>
                    <div class="color-option col4" id="col4option">
                        <input type="radio" name="colorRadio" id="col4radio" value="col4">
                    </div>
                    <div class="color-option col5" id="col5option">
                        <input type="radio" name="colorRadio" id="col5radio" value="col5">
                    </div>
                    <div class="color-option col6" id="col6option">
                        <input type="radio" name="colorRadio" id="col6radio" value="col6">
                    </div>
                    <div class="color-option col7" id="col7option">
                        <input type="radio" name="colorRadio" id="col7radio" value="col7">
                    </div>
                    <div class="color-option col8" id="col8option">
                        <input type="radio" name="colorRadio" id="col8radio" value="col8">
                    </div>
                    <div class="color-option col9" id="col9option">
                        <input type="radio" name="colorRadio" id="col9radio" value="col9">
                    </div>
                    <div class="color-option col10" id="col10option">
                        <input type="radio" name="colorRadio" id="col10radio" value="col10">
                    </div>
                    <div class="color-option col11" id="col11option">
                        <input type="radio" name="colorRadio" id="col11radio" value="col11">
                    </div>
                    <div class="color-option col12" id="col12option">
                        <input type="radio" name="colorRadio" id="col12radio" value="col12" checked>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="deleteNote()">Delete</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="updateNoteBodyById()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- New Note Modal -->
<div class="modal modal-lg custom-animation" id="newNoteModal" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="newNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="newNoteModalLabel">Create Note</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <div id="newNoteBoardId" class="d-none"></div>
                    <label for="newNoteTitleField" class="form-label">Title</label>
                    <input type="text" class="form-control" aria-label="Title of the note" id="newNoteTitleField">
                </div>
                <div class="form-floating mb-3">
                    <textarea class="form-control" placeholder="Note content..." id="newNoteBodyField"
                              style="height: 150px"></textarea>
                    <label for="newNoteBodyField">Note Body</label>
                </div>
                <p class="text-center mb-2">Card Color:</p>
                <div class="color-picker-container">
                    <div class="color-option col1" id="ncol1option">
                        <input type="radio" name="newColorRadio" id="ncol1radio" value="col1">
                    </div>
                    <div class="color-option col2" id="ncol2option">
                        <input type="radio" name="newColorRadio" id="ncol2radio" value="col2">
                    </div>
                    <div class="color-option col3" id="ncol3option">
                        <input type="radio" name="newColorRadio" id="ncol3radio" value="col3">
                    </div>
                    <div class="color-option col4" id="ncol4option">
                        <input type="radio" name="newColorRadio" id="ncol4radio" value="col4">
                    </div>
                    <div class="color-option col5" id="ncol5option">
                        <input type="radio" name="newColorRadio" id="ncol5radio" value="col5">
                    </div>
                    <div class="color-option col6" id="ncol6option">
                        <input type="radio" name="newColorRadio" id="ncol6radio" value="col6">
                    </div>
                    <div class="color-option col7" id="ncol7option">
                        <input type="radio" name="newColorRadio" id="ncol7radio" value="col7">
                    </div>
                    <div class="color-option col8" id="ncol8option">
                        <input type="radio" name="newColorRadio" id="ncol8radio" value="col8">
                    </div>
                    <div class="color-option col9" id="ncol9option">
                        <input type="radio" name="newColorRadio" id="ncol9radio" value="col9">
                    </div>
                    <div class="color-option col10" id="ncol10option">
                        <input type="radio" name="newColorRadio" id="ncol10radio" value="col10">
                    </div>
                    <div class="color-option col11" id="ncol11option">
                        <input type="radio" name="newColorRadio" id="ncol11radio" value="col11">
                    </div>
                    <div class="color-option col12" id="ncol12option">
                        <input type="radio" name="newColorRadio" id="ncol12radio" value="col12" checked>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="add_item()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- New Premade Modal -->
<div class="modal modal-lg custom-animation" id="newPremadeModal" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="newPremadeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="newPremadeModalLabel">Starting Template</h1>
            </div>
            <div class="modal-body">
                <p>
                    Here are some premade story beats that you can use to get started! Select whichever
                    suits your fancy.
                </p>
                <div class="d-grid gap-2">
                    <div class="btn btn-primary" onclick="templateHerosJourney()">The Hero's Journey</div>
                    <p>
                        The Hero's Journey is a narrative template that was developed by Joseph Campbell
                        in his book <em>The Hero with a Thousand Faces</em>. It is a common template used
                        in storytelling that involves a hero going on an adventure, facing and overcoming
                        a crisis, and then returning home transformed.
                    </p>
                    <div class="btn btn-primary" onclick="templateHeroinesJourney()">The Heroine's Journey</div>
                    <p>
                        In storytelling, the heroine's journey is a female-centric version
                        of the hero's journey template developed and inspired by various
                        authors who felt that the Hero's Journey did not fully encompass
                        the journey that a female protagonist goes through in a story.
                    </p>
                    <div class="btn btn-primary" onclick="templateThreeActStructure()">Three-Act Structure</div>
                    <p>
                        The three-act structure is a model used in narrative fiction that divides a story
                        into three parts (acts), often called the Setup, the Confrontation, and the Resolution.
                    </p>
                    <div class="btn btn-primary" onclick="templateSaveTheCat()">Save the Cat</div>
                    <p>
                        <em>Save the Cat!</em> is a screenwriting book by Blake Snyder that describes the
                        classic story beats that most successful movies follow. It's a great template
                        for structuring your story.
                    </p>
                    <div class="btn btn-primary" onclick="templateRomancingTheBeat()">Romancing the Beat</div>
                    <p>
                        <em>Romancing the Beat</em> is a romance-specific story beat template developed by
                        Gwen Hayes.
                    </p>
                    <div class="btn btn-primary" onclick="templateJamiGoldRomanceBeats()">Jami Gold's Romance Beats</div>
                    <p>
                        Jami Gold is a romance author who has developed a set of story beats specifically
                        for romance novels.
                    </p>
                    <div class="btn btn-primary" onclick="templateShortStoryRomance()">Novelette Romance Beats</div>
                    <p>
                        A set of beats aimed at a short, 8-10k word romance story.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <h1 id="boardTitle" class="text-center pt-4" onclick="showTitleModal()" style="cursor: pointer;">...</h1>
    <div class="text-center">
        <div id="kanbanBoard" class="container py-5"></div>
    </div>
</div>

<link rel="stylesheet" href="static/styles.css">

<script src="static/vendored/axios.min.js"></script>
<script src="static/vendored/bootstrap.min.js"></script>
<script src="static/vendored/jkanban.min.js"></script>
<script src="static/vendored/dom-autoscroller.min.js"></script>

<!-- Modular JS files -->
<script src="static/utility-managers.js"></script>
<script src="static/joplin-integration.js"></script>
<script src="static/kanban-board.js"></script>
<script src="static/context-menu.js"></script>
<script src="static/color-picker.js"></script>
<script src="static/modal-animations.js"></script>
<script src="static/modal-manager.js"></script>
<script src="static/template-manager.js"></script>
<script src="static/accessibility.js"></script>
<script src="static/app.js"></script>

<script>
    // Register service worker for offline support
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        });
    }
</script>
</body>
</html>
